name: è‡ªåŠ¨æ›´æ–° IPTV æµ‹è¯•ç»“æœ

on:
  push:
    branches:
      - main
  schedule:
    - cron: '0 * * * *'  # æ¯å°æ—¶è¿è¡Œä¸€æ¬¡

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout the repository
      uses: actions/checkout@v2

    - name: Install curl and other dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y curl

    - name: Set Git identity
      run: |
        git config --global user.email "github-actions@github.com"
        git config --global user.name "github-actions"

    - name: Test IPTV links
      run: |
        echo "ğŸ” Testing IPTV links..." > iptv-test.txt
        cat iptv.txt | grep -v '^#' | grep -v '^$' | xargs -I {} -P 10 bash -c '
          url="{}"
          status="â³ $url - æµ‹è¯•ä¸­..."
          timeout 10s curl -s --max-time 12 --speed-time 5 --speed-limit 1024 "$url" -o /dev/null
          CODE=$?
          if [ $CODE -eq 0 ]; then
            status="âœ… $url - å¯ç”¨ï¼ˆ10ç§’å†…æŒç»­ä¸‹è½½ï¼‰"
          elif [ $CODE -eq 124 ]; then
            status="âš ï¸ $url - æœ‰æ‹¦æˆªï¼ˆ10ç§’å†…ä¸‹è½½ç»“æŸï¼‰"
          else
            status="âŒ $url - æ— æ³•è®¿é—®ï¼ˆè¿æ¥å¤±è´¥ï¼‰"
          fi
          echo "$status" >> iptv-test.txt
        '

    - name: Test IPTVDL links
      run: |
        echo "ğŸ” Testing IPTVDL links..." > iptvdl-test.txt
        cat iptvdl.txt | grep -v '^#' | grep -v '^$' | xargs -I {} -P 10 bash -c '
          url="{}"
          status="â³ $url - æµ‹è¯•ä¸­..."
          timeout 10s curl -s --max-time 12 --speed-time 5 --speed-limit 1024 "$url" -o /dev/null
          CODE=$?
          if [ $CODE -eq 0 ]; then
            status="âœ… $url - å¯ç”¨ï¼ˆ10ç§’å†…æŒç»­ä¸‹è½½ï¼‰"
          elif [ $CODE -eq 124 ]; then
            status="âš ï¸ $url - æœ‰æ‹¦æˆªï¼ˆ10ç§’å†…ä¸‹è½½ç»“æŸï¼‰"
          else
            status="âŒ $url - æ— æ³•è®¿é—®ï¼ˆè¿æ¥å¤±è´¥ï¼‰"
          fi
          echo "$status" >> iptvdl-test.txt
        '

    - name: Commit and push results for IPTV
      run: |
        git add --force iptv-test.txt
        git commit --amend --no-edit -m "ğŸ“¡ è‡ªåŠ¨æ›´æ–° IPTV æµ‹è¯•ç»“æœ"
        git push origin main --force  # å¼ºåˆ¶æ¨é€åˆ°è¿œç¨‹ä»“åº“

    - name: Commit and push results for IPTVDL
      run: |
        git add --force iptvdl-test.txt
        git commit --amend --no-edit -m "ğŸ“¡ è‡ªåŠ¨æ›´æ–° IPTVDL æµ‹è¯•ç»“æœ"
        git push origin main --force  # å¼ºåˆ¶æ¨é€åˆ°è¿œç¨‹ä»“åº“
